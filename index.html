<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Solar ROI Card</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f8f9fb;
            padding: 20px;
        }

        .container {
            width: 850px;
            margin: auto;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .header-title {
            font-size: 26px;
            font-weight: 700;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: #2563eb;
        }

        .input-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        input,
        select {
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #d0d0d0;
            width: 100%;
            font-size: 15px;
        }

        .label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .checkbox-row {
            margin: 12px 0 20px 0;
            font-size: 15px;
            font-weight: 600;
        }

        .finance-box {
            background: #f3f7ff;
            padding: 20px;
            border-radius: 14px;
            margin-top: 24px;
        }

        .finance-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .finance-item {
            margin: 4px 0;
            font-size: 15px;
        }

        .green {
            color: #059669;
            font-weight: 700;
        }

        .btn-row {
            margin-top: 18px;
            display: flex;
            gap: 15px;
        }

        button {
            padding: 12px 18px;
            background: #2563eb;
            color: white;
            border-radius: 10px;
            border: none;
            font-size: 15px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="container">

        <div id="exportCard" class="card">

            <div class="header">
                <div class="header-title">Solar ROI Report</div>
                <div class="logo">Scaler Solar</div>
            </div>

            <!-- Inputs -->
            <div class="input-row">
                <div style="flex:1">
                    <div class="label">Customer Name</div>
                    <input id="custName" placeholder="John Doe">
                </div>
                <div style="flex:1">
                    <div class="label">Average EB Bill (₹)</div>
                    <input id="avgBill" type="number">
                </div>
            </div>

            <div class="input-row">
                <div style="flex:1">
                    <div class="label">Solar Cost (₹)</div>
                    <input id="solarCost" type="number">
                </div>
                <div style="flex:1">
                    <div class="label">System Size (kW)</div>
                    <input id="systemSize" type="number">
                </div>
            </div>

            <div class="checkbox-row">
                <label><input id="showBreakeven" type="checkbox" style="transform:scale(1.2); margin-right:6px;"> Show
                    Breakeven</label>
            </div>

            <canvas id="roiChart" height="150"></canvas>

            <div class="finance-box">
                <div class="finance-title">Financial Overview</div>
                <div class="finance-item">Net Invested Amount: <b>₹<span id="finInvest"></span></b></div>
                <div class="finance-item green">Total 25-Year Savings: ₹<span id="finSavings"></span></div>
                <div class="finance-item green">ROI: <span id="finROI"></span>%</div>
                <div class="finance-item" id="beRow" style="display:none;">
                    Estimated Breakeven: <b><span id="beValue"></span> Years</b>
                </div>
            </div>

        </div>

        <div class="btn-row">
            <button onclick="downloadPNG()">Export PNG</button>
            <button onclick="downloadPDF()">Export PDF</button>
            <button onclick="calculate()">Update</button>
        </div>

    </div>

    <script>
        let chart;

        function calculate() {
            const bill = Number(avgBill.value || 0);
            const cost = Number(solarCost.value || 0);
            const yearly = bill * 12;

            let cum = 0;
            let data = [];
            for (let y = 1; y <= 25; y++) {
                cum += yearly;
                data.push(cum);
            }

            finInvest.innerText = cost.toLocaleString("en-IN");
            finSavings.innerText = data[24].toLocaleString("en-IN");
            finROI.innerText = (((data[24] - cost) / cost) * 100).toFixed(1);

            // Breakeven
            let be = null;
            for (let i = 0; i < data.length; i++) {
                if (data[i] >= cost) {
                    be = i + 1;
                    break;
                }
            }

            if (showBreakeven.checked) {
                beRow.style.display = "block";
                beValue.innerText = be;
            } else {
                beRow.style.display = "none";
            }

            renderChart(data, cost, be);
        }

        function renderChart(data, cost, beYear) {
            const ctx = document.getElementById("roiChart").getContext("2d");
            if (chart) chart.destroy();

            let ds = [
                {
                    label: "Cumulative Savings",
                    data,
                    borderColor: "#2563eb",
                    borderWidth: 3,
                    fill: false,
                    tension: 0.15
                }
            ];

            if (showBreakeven.checked && beYear) {
                ds.push({
                    label: "Breakeven",
                    data: Array(25).fill(cost),
                    borderColor: "#1e40af",
                    borderWidth: 2,
                    borderDash: [6, 6],
                    fill: false
                });
            }

            chart = new Chart(ctx, {
                type: "line",
                data: {
                    labels: [...Array(25).keys()].map(x => x + 1),
                    datasets: ds
                },
                options: {
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        async function downloadPNG() {
            const el = document.getElementById("exportCard");
            const canvas = await html2canvas(el, { scale: 2 });
            const link = document.createElement("a");
            link.download = "solar_customer_roi.png";
            link.href = canvas.toDataURL();
            link.click();
        }

        async function downloadPDF() {
            const el = document.getElementById("exportCard");
            const canvas = await html2canvas(el, { scale: 2 });
            const img = canvas.toDataURL("image/png");

            const pdf = new jspdf.jsPDF("p", "pt", "a4");
            const width = 550;
            const height = (canvas.height * width) / canvas.width;
            pdf.addImage(img, "PNG", 25, 25, width, height);
            pdf.save("solar_customer_roi.pdf");
        }

        calculate();
    </script>

</body>

</html>