<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Solar ROI Premium Card – Scaler Solar</title>

    <!-- fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- html2canvas -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f5f6fa;
            padding: 30px;
        }

        .card {
            width: 820px;
            background: #fff;
            border-radius: 20px;
            padding: 30px;
            margin: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .header {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sub {
            font-size: 15px;
            margin-bottom: 20px;
            color: #444;
        }

        .row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        input,
        select {
            padding: 10px;
            width: 100%;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 15px;
        }

        .label {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .fin-box {
            background: #f3f8ff;
            padding: 20px;
            border-radius: 14px;
            margin-top: 20px;
        }

        .fin-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .fin-item {
            font-size: 17px;
            margin: 8px 0;
        }

        .green {
            color: #059669;
            font-weight: 700;
            font-size: 17px;
        }

        .button-bar {
            margin-top: 25px;
            display: flex;
            gap: 15px;
        }

        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 15px;
            cursor: pointer;
        }

        #captureArea {
            padding: 20px;
        }

        canvas {
            background: white;
        }
    </style>
</head>

<body>

    <div class="card" id="captureArea">

        <div class="header">
            <span>Scaler Solar — ROI Report</span>
            <img src="https://dummyimage.com/120x40/2563eb/ffffff&text=Scaler+Solar" height="40">
        </div>

        <div class="sub">Prepared for <span id="custNameUpper" style="font-weight:700;"></span></div>

        <!-- Input row -->
        <div class="row">
            <div style="flex:1">
                <div class="label">Customer Name</div>
                <input id="custName" placeholder="Enter name">
            </div>
            <div style="flex:1">
                <div class="label">Avg EB Bill (₹)</div>
                <input id="bill" type="number" placeholder="2000">
            </div>
        </div>

        <div class="row">
            <div style="flex:1">
                <div class="label">Solar Cost (₹)</div>
                <input id="solarCost" type="number" placeholder="150000">
            </div>
            <div style="flex:1">
                <div class="label">System Size (kW)</div>
                <input id="sysKw" type="number" placeholder="5">
            </div>
        </div>

        <div class="row">
            <div style="flex:1">
                <div class="label">EB Increase %</div>
                <select id="ebInc">
                    <option value="0">0%</option>
                    <option value="3">3%</option>
                    <option value="3.5">3.5%</option>
                    <option value="4">4%</option>
                </select>
            </div>
            <div style="flex:1; display:flex; align-items:flex-end;">
                <label style="font-size:15px;">
                    <input id="showBreakeven" type="checkbox" style="transform:scale(1.3); margin-right:8px;">
                    Show Breakeven
                </label>
            </div>
        </div>

        <canvas id="roiChart" height="180" style="margin-top:25px;"></canvas>

        <!-- FINANCIAL OVERVIEW -->
        <div class="fin-box" id="finBox">
            <div class="fin-title">Financial Overview</div>

            <div class="fin-item"><strong>Customer:</strong> <span id="foName"></span></div>

            <div class="fin-item">Net Invested Amount: ₹<span id="inv"></span></div>

            <div class="fin-item green">Total 25-Year Savings: ₹<span id="sav25"></span></div>

            <div class="fin-item green">ROI: <span id="roi"></span>%</div>

            <div class="fin-item" id="beRow" style="display:none;">
                Estimated Breakeven Period: <strong><span id="be"></span> Years</strong>
            </div>
        </div>

    </div>

    <div class="button-bar">
        <button onclick="exportPNG()">Export PNG</button>
        <button onclick="exportPDF()">Export PDF</button>
        <button onclick="recalc()">Update</button>
    </div>

    <script>
        let chart;

        function formatINR(x) {
            return Number(x).toLocaleString("en-IN");
        }

        function recalc() {
            const name = document.getElementById("custName").value.trim();
            const bill = Number(document.getElementById("bill").value || 0);
            const cost = Number(document.getElementById("solarCost").value || 0);
            const ebI = Number(document.getElementById("ebInc").value || 0);
            const showBE = document.getElementById("showBreakeven").checked;

            // Update name (uppercase)
            const upper = name.toUpperCase();
            document.getElementById("custNameUpper").innerText = upper;
            document.getElementById("foName").innerText = upper;

            // Base assumptions
            const yearlySaving = bill * 12;
            let savings = [];
            let cum = 0;

            for (let y = 1; y <= 25; y++) {
                let inc = Math.pow(1 + ebI / 100, y - 1);
                let yr = yearlySaving * inc;
                cum += yr;
                savings.push(Math.round(cum));
            }

            // Total 25Y savings + ROI
            const totalSav = savings[24];
            const roi = ((totalSav - cost) / cost) * 100;

            document.getElementById("inv").innerText = formatINR(cost);
            document.getElementById("sav25").innerText = formatINR(totalSav);
            document.getElementById("roi").innerText = roi.toFixed(1);

            // breakeven
            let beYear = null;
            for (let i = 0; i < savings.length; i++) {
                if (savings[i] >= cost) {
                    beYear = i + 1;
                    break;
                }
            }

            if (showBE && beYear) {
                document.getElementById("beRow").style.display = "block";
                document.getElementById("be").innerText = beYear;
            } else {
                document.getElementById("beRow").style.display = "none";
            }

            drawChart(savings, cost, showBE, beYear);
        }

        function drawChart(savings, cost, showBE, beYear) {
            const ctx = document.getElementById("roiChart").getContext("2d");
            if (chart) chart.destroy();

            let datasets = [{
                label: "Cumulative Savings",
                data: savings,
                borderColor: "#2563eb",
                borderWidth: 3,
                fill: false,
                tension: 0.2
            }];

            // Add breakeven dotted line
            if (showBE && beYear) {
                datasets.push({
                    label: "Breakeven",
                    data: Array(25).fill(cost),
                    borderColor: "#1e40af",
                    borderDash: [6, 6],
                    borderWidth: 2,
                    fill: false
                });
            }

            chart = new Chart(ctx, {
                type: "line",
                data: {
                    labels: [...Array(25).keys()].map(x => x + 1),
                    datasets: datasets
                },
                options: {
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        async function exportPNG() {
            const node = document.getElementById("captureArea");
            const canvas = await html2canvas(node, { scale: 2 });
            const link = document.createElement("a");
            link.download = "solar_customer_roi.png";
            link.href = canvas.toDataURL();
            link.click();
        }

        async function exportPDF() {
            const node = document.getElementById("captureArea");
            const canvas = await html2canvas(node, { scale: 2 });
            const img = canvas.toDataURL("image/png");

            const pdf = new jspdf.jsPDF("p", "pt", "a4");
            const w = 550;
            const h = (canvas.height * w) / canvas.width;

            pdf.addImage(img, "PNG", 25, 25, w, h);
            pdf.save("solar_customer_roi.pdf");
        }

        recalc();
    </script>

</body>

</html>